<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Avalia√ß√£o de Autoestima Saud√°vel ‚Äî Instituto Impulso</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/2.4.0/purify.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    body{
      background: linear-gradient(135deg, #f0fdf4, #dcfce7);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    }
    .card-soft{
      background: rgba(255,255,255,.86);
      border: 1px solid rgba(16,185,129,.18);
      box-shadow: 0 18px 50px rgba(2,6,23,.08);
      backdrop-filter: blur(10px);
    }
    .scale-option{
      transition: all .16s ease;
      border: 2px solid #d1d5db;
      border-radius: 12px;
      padding: 10px 8px;
      text-align: center;
      cursor: pointer;
      background: linear-gradient(135deg,#ffffff,#f7fee7);
      font-weight: 800;
      user-select:none;
    }
    .scale-option:hover{ background:#ecfccb; border-color:#34d399; }
    .scale-option:active{ transform: scale(1.05); }
    .scale-option.selected{
      background: linear-gradient(135deg,#34d399,#10b981);
      color:#064e3b;
      border-color:#10b981;
    }
    .btn-primary{ background: linear-gradient(135deg,#34d399,#10b981); transition: transform .1s ease; }
    .btn-primary:active{ transform: scale(1.03); }
    .btn-secondary{ background: linear-gradient(135deg,#6b7280,#4b5563); }
    .progress-rail{ height:10px; background:#e5e7eb; border-radius:999px; overflow:hidden; }
    .progress-fill{ height:100%; background: linear-gradient(90deg,#34d399,#10b981); transition: width .25s ease; }
  </style>
</head>

<body class="min-h-screen flex items-center justify-center p-4">
  <div class="max-w-3xl w-full card-soft rounded-2xl p-6 md:p-8">

    <div class="text-center">
      <div class="text-2xl md:text-3xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-emerald-700 to-green-600">
        Instituto Impulso Coaching de Lideran√ßa
      </div>
      <div class="mt-1 text-sm md:text-base text-emerald-900/70 font-semibold">
        A mudan√ßa pode acontecer em um instante.
      </div>

      <h1 class="mt-4 text-3xl md:text-4xl font-extrabold text-gray-900">
        Avalia√ß√£o de Autoestima Saud√°vel
      </h1>
      <p class="mt-2 text-gray-600 text-sm md:text-base">
        40 afirma√ß√µes ‚Ä¢ escala 1‚Äì5 ‚Ä¢ resultado imediato
      </p>
    </div>

    <!-- INTRO SIMPLES -->
    <div id="intro" class="mt-6">
      <div class="bg-white/70 border border-emerald-100 rounded-xl p-4">
        <p class="text-sm font-extrabold text-gray-800 mb-3">Dados do participante</p>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          <input id="name" type="text" placeholder="Nome *"
            class="border border-emerald-200 rounded-xl p-3 w-full focus:outline-none focus:ring-2 focus:ring-emerald-300 bg-white" />
          <input id="email" type="email" placeholder="Email *"
            class="border border-emerald-200 rounded-xl p-3 w-full focus:outline-none focus:ring-2 focus:ring-emerald-300 bg-white" />
        </div>

        <div class="flex justify-end mt-4">
          <button onclick="startTest()" class="btn-primary text-emerald-950 px-5 py-2.5 rounded-xl shadow-sm font-extrabold">
            Iniciar
          </button>
        </div>

        <p class="mt-3 text-xs text-gray-500">
          Observa√ß√£o: ferramenta educativa de desenvolvimento pessoal. Se houver sofrimento emocional intenso, considere apoio profissional qualificado.
        </p>
      </div>
    </div>

    <!-- QUEST√ïES (1 por tela) -->
    <div id="test" class="hidden mt-6">
      <div id="questionHost"></div>
    </div>

    <!-- RESULTADO (mantido simples) -->
    <div id="result" class="hidden mt-6">
      <div class="bg-white/70 border border-emerald-100 rounded-xl p-4">
        <p class="text-sm font-extrabold text-gray-800">Resultado</p>
        <p id="personalData" class="text-xs text-gray-600 mt-1"></p>

        <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-3">
          <div class="bg-white rounded-xl border border-gray-100 p-4">
            <p class="text-xs font-extrabold text-gray-500">IGA</p>
            <p id="igaPct" class="text-4xl font-extrabold text-emerald-700">‚Äî%</p>
            <p id="igaLevel" class="text-xs text-gray-600 mt-1">‚Äî</p>
          </div>
          <div class="bg-white rounded-xl border border-gray-100 p-4 md:col-span-2">
            <p class="text-xs font-extrabold text-gray-500">Perfil</p>
            <p id="profileTitle" class="text-lg font-extrabold text-gray-900">‚Äî</p>
            <p id="profileText" class="text-xs text-gray-700 mt-1">‚Äî</p>
          </div>
        </div>

        <div class="mt-4 flex flex-col md:flex-row gap-2 justify-end">
          <button onclick="generatePDF()" class="btn-primary text-emerald-950 px-5 py-2.5 rounded-xl shadow-sm font-extrabold">Salvar PDF</button>
          <button onclick="saveOfflineHTML()" class="bg-white border border-emerald-200 text-emerald-900 px-5 py-2.5 rounded-xl shadow-sm font-extrabold">Salvar HTML</button>
          <button onclick="restart()" class="btn-secondary text-white px-5 py-2.5 rounded-xl shadow-sm font-extrabold">Nova</button>
        </div>
      </div>
    </div>

  </div>

<script>
  "use strict";

  // === DIMENS√ïES E ITENS (mant√©m por tr√°s, mas n√£o exibe no question√°rio) ===
  const DIMENSIONS = [
    { key:"d1", items:[
      "Sinto que sou uma pessoa de valor, pelo menos tanto quanto outras pessoas.",
      "Consigo reconhecer qualidades em mim, mesmo quando erro.",
      "Aceito que tenho limita√ß√µes sem me diminuir por isso.",
      "Consigo me tratar com respeito, mesmo em dias dif√≠ceis.",
      "Eu me sinto digno(a) de amor e considera√ß√£o.",
      "Eu me reconhe√ßo como algu√©m importante para mim mesmo(a).",
      "Eu me permito ser humano(a), sem me exigir perfei√ß√£o.",
      "Eu consigo separar meu valor pessoal dos meus resultados."
    ]},
    { key:"d2", items:[
      "Eu confio que consigo aprender coisas novas quando necess√°rio.",
      "Eu me considero capaz de lidar com problemas do dia a dia.",
      "Quando falho, consigo tentar de novo sem desistir de mim.",
      "Eu me sinto competente naquilo que fa√ßo na maior parte do tempo.",
      "Eu tomo decis√µes com razo√°vel seguran√ßa.",
      "Eu reconhe√ßo minhas conquistas sem minimiz√°-las.",
      "Eu consigo me posicionar quando preciso.",
      "Eu sinto que tenho recursos internos para enfrentar desafios."
    ]},
    { key:"d3", items:[
      "Eu me sinto confort√°vel em ser quem eu sou perto de outras pessoas.",
      "Eu n√£o me comparo o tempo todo de forma que me fa√ßa mal.",
      "Eu consigo receber elogios sem desconfiar ou rejeitar.",
      "Eu me sinto pertencente em ambientes sociais importantes para mim.",
      "Eu consigo dizer ‚Äún√£o‚Äù sem medo excessivo de rejei√ß√£o.",
      "Eu n√£o baseio meu valor apenas na opini√£o dos outros.",
      "Eu me sinto relativamente seguro(a) com minha imagem.",
      "Eu consigo estar em grupo sem me sentir inferior."
    ]},
    { key:"d4", items:[
      "Quando erro, eu evito me chamar de nomes ou me humilhar.",
      "Eu consigo me acolher quando estou triste ou frustrado(a).",
      "Eu falo comigo mesmo(a) como falaria com algu√©m que amo.",
      "Eu consigo reconhecer que sofrer faz parte de ser humano.",
      "Eu me permito descansar sem culpa excessiva.",
      "Eu consigo ser firme comigo sem ser cruel.",
      "Eu noto quando meu cr√≠tico interno aparece e consigo ajustar o tom.",
      "Eu consigo me perdoar por escolhas do passado."
    ]},
    { key:"d5", items:[
      "Eu consigo me acalmar depois de situa√ß√µes estressantes.",
      "Eu n√£o fico preso(a) por muito tempo em pensamentos autodepreciativos.",
      "Eu consigo pedir ajuda quando preciso.",
      "Eu me recupero relativamente bem ap√≥s cr√≠ticas ou conflitos.",
      "Eu consigo tolerar frustra√ß√£o sem me desorganizar totalmente.",
      "Eu consigo manter esperan√ßa mesmo em fases dif√≠ceis.",
      "Eu reconhe√ßo minhas emo√ß√µes sem ser dominado(a) por elas.",
      "Eu aprendo com dificuldades ao inv√©s de me definir por elas."
    ]}
  ];

  const LIKERT = [
    {v:1, label:"Discordo totalmente"},
    {v:2, label:"Discordo"},
    {v:3, label:"Neutro"},
    {v:4, label:"Concordo"},
    {v:5, label:"Concordo totalmente"}
  ];

  // Monta lista de perguntas (misturadas) mantendo refer√™ncia da dimens√£o
  function buildQuestionsShuffled(){
    const arr = [];
    DIMENSIONS.forEach((d, di) => {
      d.items.forEach((text, qi) => arr.push({ di, qi, text }));
    });

    // Fisher-Yates shuffle
    for (let i = arr.length - 1; i > 0; i--){
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  // Estado
  let user = { name:"", email:"" };
  let questions = [];
  let current = 0;
  let responses = []; // por √≠ndice da quest√£o embaralhada: 1..5

  function sanitize(s){ return DOMPurify.sanitize(String(s || "")); }
  function validateEmail(email){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email); }

  function startTest(){
    const name = document.getElementById("name").value.trim();
    const email = document.getElementById("email").value.trim();

    if(!name || !email || !validateEmail(email)){
      alert("Preencha Nome e Email corretamente.");
      return;
    }

    user = { name, email };
    questions = buildQuestionsShuffled();
    responses = new Array(questions.length).fill(null);
    current = 0;

    document.getElementById("intro").classList.add("hidden");
    document.getElementById("test").classList.remove("hidden");
    renderQuestion();
  }

  function renderQuestion(){
    const total = questions.length;
    const qNum = current + 1;
    const progress = Math.round(((qNum - 1) / total) * 100);

    const q = questions[current];

    const html = `
      <div class="bg-white/70 border border-emerald-100 rounded-xl p-4">
        <div class="mb-3">
          <div class="flex items-center justify-between gap-2">
            <p class="text-xs font-extrabold text-gray-600">Progresso</p>
            <p class="text-xs font-extrabold text-gray-600">${qNum}/${total}</p>
          </div>
          <div class="progress-rail mt-2">
            <div class="progress-fill" style="width:${progress}%"></div>
          </div>
        </div>

        <p class="text-2xl md:text-3xl font-extrabold text-center text-gray-900 leading-snug">
          "${sanitize(q.text)}"
        </p>

        <div class="grid grid-cols-5 gap-2 mt-5">
          ${LIKERT.map(opt => `
            <div class="scale-option ${responses[current]===opt.v?'selected':''}" data-value="${opt.v}" onclick="selectAnswer(${opt.v})">
              ${opt.v}<br><small class="text-[10px] font-semibold">${sanitize(opt.label)}</small>
            </div>
          `).join("")}
        </div>

        <div class="flex flex-col md:flex-row items-center justify-center gap-2 mt-5">
          <button onclick="prev()" class="px-5 py-2.5 rounded-xl font-extrabold border border-gray-200 bg-white text-gray-700 ${current===0?'opacity-40 cursor-not-allowed':''}" ${current===0?'disabled':''}>
            Anterior
          </button>

          ${current < total-1
            ? `<button onclick="next()" class="btn-primary text-emerald-950 px-6 py-2.5 rounded-xl shadow-sm font-extrabold ${responses[current]===null?'opacity-50 cursor-not-allowed':''}">
                Pr√≥xima
              </button>`
            : `<button onclick="finish()" class="btn-primary text-emerald-950 px-6 py-2.5 rounded-xl shadow-sm font-extrabold ${responses[current]===null?'opacity-50 cursor-not-allowed':''}">
                Ver resultado
              </button>`
          }
        </div>
      </div>
    `;

    document.getElementById("questionHost").innerHTML = html;
  }

  function selectAnswer(v){
    responses[current] = v;
    renderQuestion();
  }

  function next(){
    if(responses[current] === null){
      alert("Selecione uma op√ß√£o antes de continuar.");
      return;
    }
    current++;
    renderQuestion();
  }

  function prev(){
    if(current===0) return;
    current--;
    renderQuestion();
  }

  function pct(n){ return Math.max(0, Math.min(100, Math.round(n))); }

  function score(){
    // soma por dimens√£o a partir das quest√µes embaralhadas
    const sums = DIMENSIONS.map(()=>0);
    const maxPerDim = 8 * 5;

    for(let i=0;i<questions.length;i++){
      const { di } = questions[i];
      sums[di] += responses[i];
    }

    const pctByDim = sums.map(s => (s / maxPerDim) * 100);
    const iga = pctByDim.reduce((a,b)=>a+b,0) / pctByDim.length;

    return { sums, pctByDim, iga };
  }

  function igaLevel(igaPct){
    if(igaPct < 35) return "Muito baixo";
    if(igaPct < 55) return "Baixo";
    if(igaPct < 70) return "Moderado";
    if(igaPct < 85) return "Bom";
    return "Excelente";
  }

  function igaProfile(igaPct){
    if(igaPct < 35) return { title:"üî¥ O Cr√≠tico Interno", text:"Alta autocr√≠tica e base interna fragilizada. O foco √© reduzir puni√ß√£o interna e construir autoaceita√ß√£o." };
    if(igaPct < 55) return { title:"üü† O Comparador Inseguro", text:"Oscila√ß√µes e sensibilidade √† valida√ß√£o externa. O foco √© consist√™ncia emocional e autoconfian√ßa." };
    if(igaPct < 70) return { title:"üü° O Realista em Constru√ß√£o", text:"Recursos presentes, mas inconsistentes sob press√£o. Ajustes no di√°logo interno ajudam muito." };
    if(igaPct < 85) return { title:"üü¢ O Confiante Equilibrado", text:"Boa base interna e recupera√ß√£o emocional. Refinar pontos espec√≠ficos eleva o resultado." };
    return { title:"üü£ O Autol√≠der", text:"Autoestima est√°vel e autolideran√ßa. Manter consist√™ncia e usar isso em rela√ß√µes e lideran√ßa." };
  }

  function finish(){
    if(responses[current] === null){
      alert("Selecione uma op√ß√£o antes de continuar.");
      return;
    }
    if(responses.some(r => r === null)){
      alert("Responda todas as perguntas.");
      return;
    }

    const s = score();
    const igaPct = pct(s.iga);
    const level = igaLevel(igaPct);
    const profile = igaProfile(igaPct);

    document.getElementById("test").classList.add("hidden");
    document.getElementById("result").classList.remove("hidden");

    document.getElementById("personalData").innerHTML =
      `<span class="font-bold">Nome:</span> ${sanitize(user.name)} | <span class="font-bold">Email:</span> ${sanitize(user.email)}`;

    document.getElementById("igaPct").textContent = `${igaPct}%`;
    document.getElementById("igaLevel").textContent = `N√≠vel: ${level}`;
    document.getElementById("profileTitle").textContent = profile.title;
    document.getElementById("profileText").textContent = profile.text;

    window._igaData = { user, igaPct, level, profile, pctByDim: s.pctByDim };
  }

  async function generatePDF(){
    try{
      const data = window._igaData;
      if(!data){ alert("Gere o resultado antes de salvar PDF."); return; }

      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ format:"a4" });

      doc.setFillColor(240, 253, 244);
      doc.rect(0,0,210,297,"F");

      doc.setFont("helvetica","bold");
      doc.setFontSize(18);
      doc.setTextColor(20,83,45);
      doc.text("Avalia√ß√£o de Autoestima Saud√°vel (IGA)", 105, 18, { align:"center" });

      doc.setFont("helvetica","normal");
      doc.setFontSize(10);
      doc.setTextColor(31,41,55);

      const header = `Nome: ${data.user.name} | Email: ${data.user.email} | Data: ${new Date().toLocaleDateString("pt-BR")}`;
      doc.text(doc.splitTextToSize(header, 180), 15, 30);

      doc.setFont("helvetica","bold");
      doc.setFontSize(14);
      doc.text(`IGA: ${data.igaPct}% ‚Äî ${data.level}`, 15, 46);

      doc.setFont("helvetica","bold");
      doc.setFontSize(12);
      doc.text(`Perfil: ${data.profile.title}`, 15, 56);

      doc.setFont("helvetica","normal");
      doc.setFontSize(10);
      doc.text(doc.splitTextToSize(`Interpreta√ß√£o: ${data.profile.text}`, 180), 15, 64);

      const pdfName = `Autoestima_IGA_${sanitize(data.user.name).replace(/\s+/g,"_")}.pdf`;
      doc.save(pdfName);
    }catch(e){
      console.error(e);
      alert("Erro ao gerar PDF.");
    }
  }

  function saveOfflineHTML(){
    const data = window._igaData;
    if(!data){ alert("Gere o resultado antes de salvar HTML."); return; }

    const resultClone = document.querySelector("#result").cloneNode(true);

    const styleContent = `
      <style>
        body{ font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial; background:#fff; margin:0; padding:20px; }
        .container{ max-width: 920px; margin:0 auto; }
      </style>
      <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet" />
    `;

    const htmlContent = `
      <!DOCTYPE html>
      <html lang="pt-BR">
      <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Resultado IGA ‚Äî ${sanitize(data.user.name)}</title>
        ${styleContent}
      </head>
      <body>
        <div class="container">
          ${resultClone.outerHTML}
        </div>
      </body>
      </html>
    `;

    const blob = new Blob([htmlContent], { type:"text/html;charset=utf-8" });
    const url = URL.createObjectURL(blob);

    const a = document.createElement("a");
    a.href = url;
    a.download = `Resultado_IGA_${sanitize(data.user.name).replace(/\s+/g,"_")}.html`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);

    URL.revokeObjectURL(url);
  }

  function restart(){
    questions = [];
    responses = [];
    current = 0;
    window._igaData = null;

    document.getElementById("result").classList.add("hidden");
    document.getElementById("test").classList.add("hidden");
    document.getElementById("intro").classList.remove("hidden");

    document.getElementById("name").value = "";
    document.getElementById("email").value = "";
  }
</script>
</body>
</html>
